<html>
<head>
<meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
<title>3D Game Design</title>
<script src="cannon.js"></script>
<script src="babylon.js"></script>
<script src="babylon.objFileLoader.min.js"></script>
<script>
function start() {
		window.onbeforeunload = function (e) {
    e = e || window.event;
};
var canvas = document.getElementById('renderCanvas');
var engine = new BABYLON.Engine(canvas, true);
var keys = {};
window.addEventListener('keydown', function(e) {
keys[e.key] = true;
});

window.addEventListener('keyup', function(e) {
keys[e.key] = false;
});
var scene = new BABYLON.Scene(engine);

var gravityVector = new BABYLON.Vector3(0, -20, 0);
scene.enablePhysics(gravityVector, new BABYLON.CannonJSPlugin());

scene.clearColor = new BABYLON.Color3(0.5, 0.8, 0.5);

//===TRACK CODE===//

var _xFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.025)+(3*t*Math.pow((1-t),2)*0.14)+(3*Math.pow(t,2)*(1-t)*0.125)+(Math.pow(t,3)*0.225)},function(t) {return (Math.pow((1-t),3)*0.225)+(3*t*Math.pow((1-t),2)*0.325)+(3*Math.pow(t,2)*(1-t)*0.02)+(Math.pow(t,3)*0.275)}];var i = Math.max(0,Math.min(1, Math.floor(t * 2)));return fns[i]((t - (i/2)) * 2);};
var _yFn = function(t) {var fns = [function(t) {return (Math.pow((1-t),3)*0.2)+(3*t*Math.pow((1-t),2)*0.0328125)+(3*Math.pow(t,2)*(1-t)*0.3203125)+(Math.pow(t,3)*0.2)},function(t) {return (Math.pow((1-t),3)*0.2)+(3*t*Math.pow((1-t),2)*0.0796875)+(3*Math.pow(t,2)*(1-t)*0.1478125)+(Math.pow(t,3)*0.3928125)}];var i = Math.max(0,Math.min(1, Math.floor(t * 2)));return fns[i]((t - (i/2)) * 2);};
/* START CURVE DATA 
{"start":[10,80],"init":[56,13.125],"segments":[{"a":[50,128.125],"b":[90,80]},{"a":[8,59.125],"b":[110,157.125]}]}
   END CURVE DATA */

//===END TRACK CODE===//

var xFn = function(t) { return 650 * _xFn(t); }
var zFn = function(t) { return 650 * _yFn(t); }

var playerSphere = BABYLON.MeshBuilder.CreateSphere("playerSphere", {
sections: 12;
diameter: 4;
}, scene);
playerSphere.material = new BABYLON.StandardMaterial("playerSphereMaterial", scene);
playerSphere.material.diffuseTexture = new BABYLON.Texture('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wCEAAoHCBUWFRgWFhUZGRgYGh4eGRwcGhocGhkaGRwZGRwaGhocIS4lHB4rHxoaJjgmKy8xNTU1GiQ7QDs0Py40NTEBDAwMEA8QHxISHzYrJSw1NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NDQ0NP/AABEIAOcA2wMBIgACEQEDEQH/xAAbAAACAwEBAQAAAAAAAAAAAAAEBQIDBgEAB//EADgQAAEDAgQEAwgBBAICAwAAAAEAAhEDIQQSMUEFUWFxIoGRBhMyobHB0fDhQlJi8RRyFYIjosL/xAAZAQADAQEBAAAAAAAAAAAAAAABAgMEAAX/xAAlEQADAQACAgEEAgMAAAAAAAAAAQIRAyESMUETIjJRBGEUM0L/2gAMAwEAAhEDEQA/AMVLr6z+/wArrfNHlqg8BbkjPoMAVYKVlYynJRLm6NaEW8+TmyjD0gSL7iUzwtIEk7NFrRJQ2HyXkwQj6bA9nhOqjdHYAYuqDIMkzAuLWB5XufkjmcMY1md0gTEzNuei9huGsHjebDTqqOJYlz8rBYH6JfNekVmPlkmcMzOibhv91pkWEA6BRxPDsn9xLnEN8XwwGmSIvcnlorcXXbSDS9puPCBcwNzGi7T4jSLQ+19DqWu009T5AKdcylauzTHA6ePpFVDDsa6Krw0DYESegVeLZYvYG5BFpkn+VRxzBtgHNJN7C/nHJJaTaj5aHGG3JiRbQySFN81Ut0t9OZ+3NHDnvazM9rWtJLQAb5gYIMTAnf6pjgHsyF0QQYdJ0P4WVfVcBDhbUTr3gFE0MWXANbYkRPbSTN1SeSs0SuOX16HzqIe6wkC5jTzXsSxrhDXQRslNLib6GZhFjdzeZtYkHSOSv4cwPcSHyCAXCASNzBPwgefku/yGn2ugf4ya6fYY6mQ2TBQr+HNeJAhD8Q4wA4hkwP2db+S7wviL3uLSZEEmwEAam211aeZNa0Rrhzr2Uv4c8aEFV1KLojKZTL/yVKcpkcjFiivdMc3Mx0/nryTq5r0S+l4iFjMrJOqpeZ1ReKxDmktICoFK2Y3C5k3LXo9TZayqqOvCuf0QzkqFOkrrSoBSBTAaOPdJUm0ZUCxXNAXNhQ5ZQe74QqKrCDB1T6o8BvhBEa/lC+4Y+5eI+aE8nfYcBMHgXuvoEVWrtp2a0E7lXYiuGMhqVPJIlTqnT79BSLsPSzvBjw7ooYkB+XRjdgh8Gx0EkwFN2FygvNgdzsFOn+x4TdYgrE4kPiNtBp5lBYnFNY3MIJP9WwH+M8+aDfimCQTrpG/eEJjnveMgjwwO9jYfJRqu8R6ESpWv2CYvjBeXNe4wNIsYG0kW9FNuBeLQ4EQSAJu6wbbeyGw2FDXtL46SYHSTyTTFY97CYcRJkmZkncchASvF0gpt+wbiHEC5zRlyZG5Rlm8amTvKjhqjgIIJz3FtYn+dUK0lzzmiDJkmOvko4asWPBddoMxsYTYswHk90s4m5wN7d9VVg2eNsPBE7CSO4e2PO4RGPrCs4uLiSSSNGwOUEwfVBVaGUeF8k7QQUVTc4LX5aOOMUGZyWOc/dxzNkE6zlEJeOJvpAtZADviJAJIG08uyGwdCo+Qyf8hmgRre916vRLTBG176lcksx9nOn7XR2lUc8zre/RF0nPYC9kCQRc7HVB08Y/KGSYm0QFzEPcANgb8r/dP7WC+Wdhbg6oW+NrYGxn/aM4fjRTe0E2NnGdv41SmlRL2mHRG91BzHbEfQ+q6en0CnqNjxTB5hnbfslb6L8sBpIS7h+MfSdZwncH4T3jValuND2BzWaDxAHQ8ha6uuRZ2R+k36E4wz4+GFXXwrhHVaSm3NEq9+FbEEXTrGTcoyTxlaqQE6x2FbMOB6EIYYFp0cZRSwFLV0BKElMKGFLCXO0GiCqVZJsiTU57NvUrhzC2Lm07pV7gZoBOUalRdXJNjELlCsbiddVmlNFMLasEBu3ZAVzldATOiwsYS/fSUGzCue8losLkpk0DA3DUi9zW+qX8Xruc6oG3yWA6Ax/Kc4ShUglkHa6ztQZS+TDiTm0mZvrss9vTXwTi0AwdPMWue/KGuENIuYIJ7BXYvHMDy9oOYE/wDU9f3khHOAGaJk8gPoFU9zSDa+yT50tvRLEYpxEgCDra6hUdJ8MWN9hOsoR1YgQq2P5pkibonUrumDr+dlbhqOc3+aroMzGYtstNwvg+aM1kKpSPxy6YLh+H2zyOg/CmzCNcYIIdBOktIHlbb8rWUuHsaLT5qL+HAyYi0WWf6pq+j0fP6lNzXEN8IP7uq8RTImfWP260fFOHkEDKe+wjmk+JrBjSxzJM/FOafwrxWma48XgpD0TWfmEbDS8xN4uqX1ADporALbX7/hWRArFVzRDXEA6gSuUTJ1lReYMbKFN4aZP79kWDQo0nA6hH4PG1GAgPa0a6ST8ilrG5jObyMfZXMY4GYsVyONZwfH+8EujM3laesJv7yVh+G49tN9wY5SN1q8DjWVGyyeoOoVYr9iVPfRfXp5lXSoiDZEZrLmZV0mLOJAhlhpqkMLUV2EyOaXf8ABdoGtL8TzAVmFbo4Cb6Kx9AgeLRdpVGs0IWZ11iKKGyeIa55AOkqWZwkD1QlfiAJUcMx73NgGCQJS687HXEv2a7AMFPD5nauuvn/tBd7iDqvonHaQ9wWjVoBXzljHOdNQENcJaeeoEeYKg2/ZomZSwVyXQwW8RN1XUaMv+XJXVmZXWQj3SU3sV9EabG+KSZ2H1XWMZlJN3aNaPqVE0S0gvDg1zSWkeYB7SoUzleD3+hTkx1wJrHuaxxDTMXsCt/hcK1o1Xy9sO1PePxut/gnhlFjWmYbbrZZeY2/x30aKizkrS3osfgvbLIMtWmQ8WMad76Imt7bM2YT5/wAKP06/Rb6k/sYcTpSCVhuIUcz/AIYvEmYP4Tev7Whwj3dueb+EsfjmvnLvqCrQnPsjyVNLoS8Rw8Ot0/ZQrHHSBZNf+M57nRMxMbGNUG+kIiwPdapaZkpNMDqm911+Ui2qjVadyu0HAfEExM7QY7bZXHFZbBt+c/ZeY69jEqDqA1XZofQUwMJDnNm3a+yb8AxLKb/EYkW5X5pJQE2OyuokSDFpv+UfJboUjde+DrtIKkCkvA2XcR8OycvcrTWolSxg+MrAbpZUxL5N1dj649FVSpkgHmnEGvEqJECdUPh+HzqmGOeHszAruGILQVi1pGqUmxUeHy4gHRaPgtCcrf7dUqrWcMpuStNwXBPDHPtK6q9BU5pR7RMeaRFMSZv27nRYDE1H5QxwcHNnwnUH4vnK+l08S15LZgjZKvaLgjHsc/Nkc0Tm/pjkf4StBl/B8tqudJOvNX4pjCWChL8wALSL5101ntYQ2wdYkC5HKdlCjTex7HsJdJGUtkOzf2xzRAyjH1HEhrwWvYC0zrY2HzN1DB0C91hMCfPYfvJM/aR7X1nPYcwEBxiBmEggeit4LQOQGNSfwuqsR0x5VgbwXCU/+O5lQeNzydDLdGggx0nzTrDYZzaTcxuAB3IUMPRDRpJVtevIA5LPVeTN3HxeCM7xfcxdLsBSqVMxYHOyRmgAxMxbfQrXHBMeIcJB1R3s3hhhG1AwB/vCDLpBAAgNsDO5nqiqlLGSrjp1qMfQe0HK9o6y2CO4RlXhrCMzRHUJ1xmiKv8AQ0HYgmR2MIDD4ZzGw43QdL4Zyl+mhWx5Y6ZiRBMTY6qqlgWsY+q8kgy1g0zdSJROPw+YRMdkBiaji1rCSQBZUh70SucFhcCLhDOR9eiAYbedEMWXy7zdW0g0WNpGNV2m2DdX1sIW3H++0Kg0yDr++a6WmFpo4+pDban5BXMcS1p2FiuU6YNkVgcKXEMHNPiQFpqMEWtY2NIVmJrQJVraAAAjRLeK1YEK0rojTF2Jq7c1cynb4ig6DP6nK7/lBB016DiG9WqIjREM4k0MDQyY3S99yuGwUWtXZVPPRfmLiIJknRfQcVXFDDNZHicLr5s2oWkEGCDI8k7dxl9YNa/UfNI51oZUHYfUvOp0RWJcatJ1JxiRY8iDI+YUsJhXFrQBJXcRhKg2slb2mP6Rmh7KPeAA8BsunexJIt/KB4p7MPw7A9lUu8QGXIQZdIsQTaFvMC45Li+6MYyReEMwXez4xiuHvYw5vDMODYiQZuFouAsa1jCdcgPmbrSe1vAHYnKWFocyYn+oGLW006rO0cK5mWm8Q4ANPcDUFTt7Jo4cVaOxi25YLR33QNUtKofhXi2vXRDMwdQGxPrP1Up6NVV/QywFWZG4KatfASTDMLLnU6ot+IkJa7YZfRbiMQBoldepKsqPlDORSBTBqwlA16ElvdM3MUHABOnhC50Tin4vFqFJ2Fa4l1wTyj8Kb6Dy4k78kTTomL2AVHT9klPwBY1uSk4dIHmkV+ZKYcUxWd2Vnwt35nn2VQwxyE+nVUnpdkbevorotNoKZYWsWvBFkrYwpngxmIB0VUvkVGypVs7GkbhI+JVBnh2i0GFaA28WFoNlm+LUHudYK6/EhSygavUGUlplBe5JvOq97ojWy5nKTAt6aPIouVkrzGZnBo3IHqkpookV06LnGGgnsnHCuHEvAOv0WjxTKeGotYyMx1O8obgldjHF73ABTVNrUh8w1eBwIY2d4Q+PAa0qke0OHdYPjuCh8Y5r/GHBw7oTNJ/chtTFeGxcViw2BFu4TWnUBWafm9+2b3tHValjItsu5OmCURc2SOix3HmEVC4c4/C3GVZfilEFzwRqVLN6KS/F6ZPDcSrOe5mdgc06OjxDmEa3EV9XNYezo+qF4nw2m53jZcWkEg+caoalwygNGT/2JI9JhL9mF/v/AGsGoxYJyu8LuRIPoQYKtQVLh9I6sb6AfRGuAAgbKdJfA8t/JU5QyqcLhKAdKK7w1pc4wAJKytbiby8va4jkNRHKNEbx/ElzgwfCLnrySVzekLRxys1mTmtt4hm3jj9Cxk87/SUNisdVfYm3Jtm+mp80HujMLRc4wBcqvjK7wl5U+myzD4RzmmAfLmtFTwU4XMDBiTKA4ZgXfEQ4s3ImD/dBH6VsX4JjqeSIbFvJcp05vEfOqYI9UxoZRc6lX4nh+WoGNIdJ2/foi3cJPIqkzorrxF9XFO0BI80OMS8n4j6pm/hQAkgpViKeR0BVzCbrSZrHdVLwXJRTENCwOJAAknZMRhKlNucs/hAYauWODm/ENE6rcRNSi9zuyy1urPRpnO9FmIxTnulxkqFXEEwNghwVbSpTdaZX6JthGGqSYTLCYrLLZgFL20stwq/eGVVvrGBGk4PTDq0/EGiVoBUMmyQ+zuNaxrj/AFOIATuo+/VeZzP7jRPo698LP4l8vd3Tmq63VJcfRzi1njyzfys755l4ii42/Yvx9KfFHdACmEzwlMPqNzuLT8L4tmG0/QozivAWg5qLiBu12x/xIvHQpt8u0UmvH7WI2qRCk7DuaYKC4pSfAcxxygeJu/fqEPFhdySqVgOpVDnk6oWm9er1ICKk510cwPC24io8lxAaGi3Myj+KeyRIZ7m4ghxJuTsdEN7LP8TwdHEDzi339VpmVDTtty3HYrVCMlPswR4JVDsrqZF40K0XCPZ0ZC54c10mAbAtOxT2pxAgWcD3bp/9kjdjnsLnF5c4kwdPlJED7ovoA2wmALCQD4I06842RzCIg6JdgOJB4GeGmY6H8JgSimK0QZg6bTma0Tz3U7KDiQo1awAkp1QrQFxK7TsB81jMePGthihmaST2WRx3xKkvoSkVMbzV7a7B/QhlxEUd54TOvhvAHsMsPxDkULXwzWCSCZ05A8k79nWDLcgNm7T0UG87L49wTU8OTeIHVM+F8PfUJDAAGiXOcYa2dNATJgwANk4rUKeRzQcxJJAG06L3C2OplzTo8R5tkj5F3yTPmcy3PsaYTpJimth3tdls49NPmrv/ABboBc5oJQ+PxOV5M3BXsHxMZ/GNEj5qqdH5ONS+vQRSHuarWfGTEAcynOJxBOh0/ZVHD8MHF9Z8EvEMH9rdz3P0HVdrsLe3Nefzcjp4X4oSWl9Kvmsdfr1VOIZOmqGL4PZX+8kSFByUfQtxTCfG34xr/kOfdNOE8RFQZXfELIHENIOYJfXljw9tgdRO+4T8dNdE6WjvimF3CQ1qOZzSIlsgg7tNnD0Wlw2JFVn+Q+Y2KWY6hl8XqtaeokzHvZkc5vIkKnEvsieKkF+dplrvk4WIPyPmlmIfZMp7O8ug/wBm2kudG7gFpcTUlJ+CUCxt9Yk9zaP3kjK9a0p17Itg+IeSQ0efZL6njdA00HbmiHvhpdu5V4ZsAu8guqgpdBDNQBsnmFqyADqNPwkWH1lNKD4Erp/Zz/Qa2qCDeSqKjibEKNN4jrN1GvXiw1KdAKcTVEOG4Cy2N+JairRBaSdVlsX8SrL6J0UheUZUcypoh9BGFYaIe91nyA0D+1xEzPMSp8IptDImYJ7+fVDj4SI8O3feP3ZUYfEljwR8JMOH3WDzb1M9PwlymvY+xjGU3Bk+JwFwIF9Lyh3k2a0OBDpB2nqvcYpveXOa2QyxMgddyrmsL/hk9R+UOO9WncvGpzBDxKg5rzmGtx2N0PQp5ngSQCbkagD4iOsBbDFcKzMYHzLW3O9ySB6ELNYzDCm7wn/SMV00vZ1zqTY5FYEwxwIGgGoA0EI4XZBFz8uSz3DXMDpc7xRLb7/cplhsWDIXn1OUP8FLipUakGOf1XcSLzsVQnRz7QXUEiECW5gWHfTujWPkDnuh8QzcINZ2J/QNwrEljo3B06f1D7rQYloeLXBWZxjcrmvG/wBRt6J3wvFBzcvmO3L1Wnjek6EnFuDBrH5d/EOhGw+izXCsG6o7ObMadeZ6c4X0bF0hlP7ZZ6oGtAY0Q1osBstEka6KXENEDRAvOd0bBWV3knKBJNgoV6RY3LudUzeIRJtg1R2d0DsPyrn7AbLtCgWjNudOynTw5N1Kn8DHGBFtfoFFuHIuuMaZTJoKT0vY+4U7SbeIWVTG3VxvprHqE6eAr2U4qtDSAJKzGKF1pqjPCVnMXqrR6JWCQvQjcNhg+ALkq2pgGAkZ9OicRJsf+9mSZMCbdOQCnXwr8rXljmtcQDIiJMXGwXcM/Ic++vpt8lVV4xWqWaDB5Lz5497+T0K5HL/odCras2bF7f8A9KHC+IFgc0QYMgG+useYnzQOHzuzBwOYi45uaQLeTp80DVkO3BBn9CTiTVOWaaaqVRpH8Wzkum+4SHGVMxJXX1Wm4sVSbrXPGk9JVWoXvY4vAbv9v0Jjh6FSCQbt+YVbCWlNuHOGfuCPv9lj/krKBK1FLMS4iCpU6yLFISQhMRRh1lnmtGzHgRQqQe6IeJslwMIynVkSqLsWugd7JBYd9D15obA1C1xbuDby1CLxOxQOKdcPFtj3CaHjFrtGncWvpk6CLk7Xn7Ieng2ObmZBBGutweiDwFQPaWEw1+h1yvHTkUxwWBNEOLn5i7kIAjTXe+q0eXWk/EW/8JjMz3ax4f3mdO0pfSwpqPv3PQckXxPFZnZdhc91fRbkYBu65WauR+2UmElgLUw0mB5IlmDAV+HZuiJA8kqtnOULMVSAgBBupojE4jU7lDMq5iqywNJItpUrSVWyxLuQJ9ES94AQeJdDP+x+QVvLXhLPksw7A8a6a/ledwZnKe6Aw2ILHBw8xzHJaCrXaGZxoRZWmvgnU9inE02UWFwaAYgLOPJJmdUVjsVndc2CHyBV0GGmIFun79iruEiKIEQZPdDOG3OD9Pymr8RnyhuUQBYfdYvaw018MprY11FzHhsgSHc4Ig/vRB46mKniBN7g91Zj6xDXAETF90w4bwx1Q06TSAQ0ZnHQBoEnqZOiW68EqH479p+jKtZUa7xQQOX1RHVaPiPBKlNxygVG7OaCfVsSPKR1Sh0aEKsfypaD9P5TBi9E8Oqw9vf5Gyg6mF7CNGbWYNwl5ai5Oxz2OGOh5UcW7QqzFU8pa8fC7Q/UdCoVRmasSnHgfL5AXulToOtCqMLlJ99U8grtBFQyD9EKxuYFvPToVeXIdph3mm+RF6I8Pec2SddOhC0NfFHIM2oF+sflZp1qn/sE7xPwO7LqbzENnyK8OC54ncz90fVdJQvD/iPZXU7lRr3g6DWWsqcbWhsc1LMUux9S6aFrEBXGSq31Q0rrXwZ2UKfDcRUuyi93eGD1eQCr1InbL6dQuN9FTiauY9BYflavhfAWMYPfND37tmWDpAs7zXsXhcM0GKNIdmNafUCUIrGOuJtaY4sU3PdkLZ6j7qWKcA4xYIf3y0eeMk5Fx1tCnDuiKrYUu8Td9ehVf/Cfz+S0JprSLWMZYiqLgG5FzsOib8Gq0hTDKjZdHifNzHMfys7hsMA4uuSTvsNhGwEpp7wAAHyNh69FmlL5NDafRo2cPwxY7J4pBkzMHkeShw4PNemW/wBzs3/UscI7SR8kNwbg9XJ70Pyh2ggjO2A7Nf8ApIP1T3hFEMfJN8pj5D97LN/IbS7Hjxx4aXC4drb6nn+AvnXti5hxD3U4EZc8aOJF3eov2lS9sfaisw5KZyicpPS8nzgrIUazjJJJJ1J3lT4eJpeTFl/cEVaxjVB8OxTm1HD59fwVbVdZDYRl55laEljGtm94PiG1GFjrg7bg/lBVg5jiw3jTqNigOF4jJUadna/T6/VOvaCl4GvGxjyP8qM/ljA+lohrVLkL1J9wh677rtF1wqucB5aMiUO/4vNXMKpqfEps5Eaw8fp9k5xJ8DuyS4l3j9EzxVXwOvsuY2g3D/6u35RNAXQuAdZ6ZcLwjqhMEADUnT+T0UqXYy7K3lC0OHPrOJHhZPxHf/qN/otM3htJvxS49dPQW9ZV2Vug+VlSeh5j9i/CcOZT+Fsu/uN3fx5Kx+ODDqiXU53Pqs7x+kBpPqU8p08KPJXR3iXGySQw9ys9W4qTOrup0R1DhrHthznt/wCpbbuHNKExPs48DwVM7RsRB9dD8k6mU8M18lP0A4jFzCpoPLndAoPwZzQ7NI2hE06YYNh9U+JIjrb7D6T4Ibu7/ash/JVYHDOMvjtOp/CNkq/G1glewRzmjcAhVvx5aQ5vxT4emlyN/wB5JTUxDtrD1+cfZX8LDHZveOdA8VtXGwiTprr0U09fZTD6B7OueWuq1KhdIIvo0EcuaCfxA+8MH4TbsBP1uktfjT3nJTZJOgGltzzKrwFcl7muMvAv3FiPVS5YdV5MKamcQ6ocCGOZUl5a+bGJ8Q0PqFm8XwrEYYltak4Ro9rS5jhzDgLdjBTrhGKcxzwHlt5HXdOqPFn7me903xgsvOz52/EZ7MGY9PudlfhqbmtvqP8Aa2WNeH3cB5BD8L4R72XaNzQVPkpTOjztUMeI+zbRh2VKZJe0NLhzDmgmOV13Fuz4Qk6xfu2D9Qtcyn/8Zb/gI/8AUJLxrCsbhC4Wu4GOoKx8Ft2kx6/Fnzeo6SrKbrhCOfdWset/skhsxyi83UGOXnm6jSwaSOLd4x5IzEP8B7JfiT4x5JhiB4D+8lzCS4NhXPa+IAEST9E9w2Naxgp02l7hd0CJJ1MkxCQcNruax0GJP2RGDxLmFzreJKnKfZePFezQuxbGiXOExprBSLE8TLXlzTI3F4QGNJeZGqFp1CbGx+qeXj0pVL0jQ8I4znqhj7Tp16JnxvBBzZAFvVYh1IhzXgwWmQVpafGszDOsJm8rUIvu6YoxLC27bEct1ChiybixGo+6mzFB7iNx+yhMTTLHBzbKjwyvp4HPe148QQ2GwdIOvM9bhdmIcNCJU6rJEjZJ5L0wYMMSQ1joI0KzXv3f3FEYutDcm5+Q/n8oNX4liJcjxgBCpY7Kehsey8vJZLV6GWGJpuBb691ZgAQ8P3n/AGuLyrz/AIolx+2NnjK8t53CJbUIXl5QXoZ+yutWctP7DDNTqtOuYEen5Xl5R/kf62NP5Glp2a08iQfP/aSe1jy3B5eZdPrC8vLDwf7EUv0fKibq1hXF5emTQzpuUnTK8vKdBkhWbLx5cuiYV/gPkvLyVjohhW+A91LNZeXlL/oZ+hTxOodiR2KbYmjmpyLGBpa/kuLyt8oR+mZ6nVOYtdqOsog4ggWJHZeXlV+xZp4BYBzzXBb/AE/FfUHb7+S1VSnmb3HzXl5GxE3oJhxLY/tP1V1WsGU5NzoBzK8vKUraQ9ehCXkmTqVOSvLy2mQ//9k=', scene);
playerSphere.position = new BABYLON.Vector3(xFn(0), 9, zFn(0));
playerSphere.physicsImpostor = new BABYLON.PhysicsImpostor(playerSphere, BABYLON.PhysicsImpostor.SphereImpostor, {
mass: 1,
restitution: 0.9
}, scene);

var camera = new BABYLON.ArcRotateCamera("Camera", 0, (3 * Math.PI) / 8, 20, playerSphere, scene);
camera.attachControl(canvas, true);
var light = new BABYLON.HemisphericLight('light1', new BABYLON.Vector3(0, 1, 0), scene);

rampAt(xFn, zFn, 0.80, -Math.PI / 4, scene);
rampAt(xFn, zFn, 0.88, -Math.PI / -4, scene);

for (let i = 0; i < 0.80; i=i+0.009) {
 wallAt(xFn, zFn, i, -6.1, scene); 
}
for (let i = 0.90; i < 1.01; i=i+0.005) {
 wallAt(xFn, zFn, i, -6.1, scene); 
}
for (let i = 0; i < 0.80; i=i+0.009) {
 wallAt(xFn, zFn, i, 6.1, scene); 
}
for (let i = 0.90; i < 1.01; i=i+0.005) {
 wallAt(xFn, zFn, i, 6.1, scene); 
}

scene.registerAfterRender(function() {
var vel = playerSphere.physicsImpostor.getLinearVelocity();
playerSphere.physicsImpostor.setLinearVelocity(vel.scale(.98));

var forward = camera.getFrontPosition(1).subtract(camera.position);
forward.y = 0;
forward = forward.normalize().scale(1);

var backward = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI));

var left = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY((3 * Math.PI) / 2));

var right = BABYLON.Vector3.TransformCoordinates(forward, BABYLON.Matrix.RotationY(Math.PI / 2));

if (keys.w) {
playerSphere.applyImpulse(forward, playerSphere.getAbsolutePosition());
}
if (keys.s) {
playerSphere.applyImpulse(backward, playerSphere.getAbsolutePosition());
}
if (keys.a) {
playerSphere.applyImpulse(left, playerSphere.getAbsolutePosition());
}
if (keys.d) {
playerSphere.applyImpulse(right, playerSphere.getAbsolutePosition());
}

var currentT = tLookup(xFn, zFn, 500, playerSphere.position.x, playerSphere.position.z);

if (currentT > 0.99 && currentT < 0.992) {
win();
}

if (playerSphere.position.y < -10 && playerSphere.position.y > -10.2) {
lost();
}
});

function drawPoint(x, z, zrot, scene) {
var point = BABYLON.MeshBuilder.CreateBox('point', {
width: 10,
height: 0.5,
depth: 12
}, scene);
point.material = new BABYLON.StandardMaterial("pointMaterial", scene);
point.material.diffuseColor = new BABYLON.Color3(1, 0, 1);
point.position = new BABYLON.Vector3(x, 0.1, z);
point.rotation.y = zrot;
point.physicsImpostor = new BABYLON.PhysicsImpostor(point, BABYLON.PhysicsImpostor.BoxImpostor, {
mass: 0,
restitution: 0.9
}, scene);
}
function drawParametric(xFn, zFn, start, end, res, scene) {
for (var t = start; t <= end; t += ((end - start) / res)) {
drawPoint(xFn(t), zFn(t), 0.42 , scene); 
}
}

drawParametric(xFn, zFn, 0, 1, 350, scene);

function tLookup(xFn, zFn, res, x, z) {
var minT = 0
var minDist = Infinity;
for (var t = 0; t <= 1; t += (1 / res)) {
var dist = Math.pow(x - xFn(t), 2) + Math.pow(z - zFn(t), 2);
if (dist < minDist) {
minDist = dist;
minT = t;
}
}
return minT;
}

function derivAngle(t, xFn, zFn) {
function derive(f, x) {
var h = 2.2e-10;
return (f(x + h) - f(x - h)) / (2 * h);
}
return Math.atan2(derive(zFn, t), derive(xFn, t));
}

function rampAt(xFn, zFn, t, angle, scene) {
var ramp = BABYLON.MeshBuilder.CreateBox('ramp', {
height: 8,
width: .25,
depth: 12
}, scene);
ramp.material = new BABYLON.StandardMaterial("rampMaterial", scene);
ramp.material.diffuseColor = new BABYLON.Color3(0, 0, 1);
ramp.physicsImpostor = new BABYLON.PhysicsImpostor(ramp, BABYLON.PhysicsImpostor.BoxImpostor, {
mass: 0,
restitution: 0.9
}, scene);
ramp.position = new BABYLON.Vector3(xFn(t), 3, zFn(t));

ramp.rotation.z = angle;
ramp.rotation.y = -derivAngle(t, xFn, zFn);
}

function wallAt(xFn, zFn, t, offset, scene) {
var wall = BABYLON.MeshBuilder.CreateSphere('wall', {
diameter:4
}, scene);
angle = -derivAngle(t, xFn, zFn);
wall.material = new BABYLON.StandardMaterial("wallMaterial", scene);
wall.material.diffuseColor = new BABYLON.Color3(1, 0, 0);
wall.physicsImpostor = new BABYLON.PhysicsImpostor(wall, BABYLON.PhysicsImpostor.BoxImpostor, {
mass: 0,
restitution: 0.9
}, scene);
wall.position = new BABYLON.Vector3(xFn(t) + (offset * Math.sin(angle)), 4, zFn(t) + (offset * Math.cos(angle)));
wall.rotation.y = angle + (Math.PI / 2);
return wall;
}

engine.runRenderLoop(scene.render.bind(scene));
window.addEventListener('resize', engine.resize.bind(engine));
}

function win(){
window.location.reload();
alert("You WIN!");
}

function lost(){
window.location.reload();
alert("you lose!");
}
</script>
<style>
html, body {
overflow: hidden;
width: 100%;
height: 100%;
margin: 0;
padding: 0;
}
#renderCanvas {
width: 100%;
height: 100%;
touch-action: none;
}
</style>
</head>
<body onload="start()">
<canvas id="renderCanvas"></canvas>
</body>
</html>
